!function(){"use strict";app=app||{},app.User=Backbone.Model.extend({idAttribute:"_id",url:function(){return"/admin/users/"+this.id+"/"}}),app.Delete=Backbone.Model.extend({idAttribute:"_id",defaults:{success:!1,errors:[],errfor:{}},url:function(){return"/admin/users/"+app.mainView.model.id+"/"}}),app.Identity=Backbone.Model.extend({idAttribute:"_id",defaults:{success:!1,errors:[],errfor:{},isActive:"",username:"",email:""},url:function(){return"/admin/users/"+app.mainView.model.id+"/"},parse:function(a){return a.user&&(app.mainView.model.set(a.user),delete a.user),a}}),app.Roles=Backbone.Model.extend({idAttribute:"_id",defaults:{success:!1,errors:[],errfor:{},roles:{},newAccountId:"",newAdminId:""},url:function(){return"/admin/users/"+app.mainView.model.id+"/"},parse:function(a){return a.user&&(app.mainView.model.set(a.user),delete a.user),a}}),app.Password=Backbone.Model.extend({idAttribute:"_id",defaults:{success:!1,errors:[],errfor:{},newPassword:"",confirm:""},url:function(){return"/admin/users/"+app.mainView.model.id+"/password/"},parse:function(a){return a.user&&(app.mainView.model.set(a.user),delete a.user),a}}),app.HeaderView=Backbone.View.extend({el:"#header",template:_.template($("#tmpl-header").html()),initialize:function(){this.model=app.mainView.model,this.listenTo(this.model,"sync",this.render),this.render()},render:function(){this.$el.html(this.template(this.model.attributes))}}),app.IdentityView=Backbone.View.extend({el:"#identity",template:_.template($("#tmpl-identity").html()),events:{"click .btn-update":"update"},initialize:function(){this.model=new app.Identity,this.syncUp(),this.listenTo(app.mainView.model,"change",this.syncUp),this.listenTo(this.model,"sync",this.render),this.render()},syncUp:function(){this.model.set({_id:app.mainView.model.id,isActive:app.mainView.model.get("isActive"),username:app.mainView.model.get("username"),email:app.mainView.model.get("email")})},render:function(){this.$el.html(this.template(this.model.attributes));for(var a in this.model.attributes)this.model.attributes.hasOwnProperty(a)&&this.$el.find('[name="'+a+'"]').val(this.model.attributes[a])},update:function(){this.model.save({isActive:this.$el.find('[name="isActive"]').val(),username:this.$el.find('[name="username"]').val(),email:this.$el.find('[name="email"]').val()})}}),app.RolesView=Backbone.View.extend({el:"#roles",template:_.template($("#tmpl-roles").html()),events:{"click .btn-admin-open":"adminOpen","click .btn-admin-link":"adminLink","click .btn-admin-unlink":"adminUnlink","click .btn-account-open":"accountOpen","click .btn-account-link":"accountLink","click .btn-account-unlink":"accountUnlink"},initialize:function(){this.model=new app.Roles,this.syncUp(),this.listenTo(app.mainView.model,"change",this.syncUp),this.listenTo(this.model,"sync",this.render),this.render()},syncUp:function(){this.model.set({_id:app.mainView.model.id,roles:app.mainView.model.get("roles")})},render:function(){this.$el.html(this.template(this.model.attributes));for(var a in this.model.attributes)this.model.attributes.hasOwnProperty(a)&&this.$el.find('[name="'+a+'"]').val(this.model.attributes[a])},adminOpen:function(){location.href="/admin/administrators/"+this.model.get("roles").admin._id+"/"},adminLink:function(){this.model.save({newAdminId:$('[name="newAdminId"]').val()},{url:this.model.url()+"role-admin/"})},adminUnlink:function(){confirm("Are you sure?")&&this.model.destroy({url:this.model.url()+"role-admin/",success:function(a,b){b.user&&(app.mainView.model.set(b.user),delete b.user),app.rolesView.model.set(b)}})},accountOpen:function(){location.href="/admin/accounts/"+this.model.get("roles").account._id+"/"},accountLink:function(){this.model.save({newAccountId:$('[name="newAccountId"]').val()},{url:this.model.url()+"role-account/"})},accountUnlink:function(){confirm("Are you sure?")&&this.model.destroy({url:this.model.url()+"role-account/",success:function(a,b){b.user&&(app.mainView.model.set(b.user),delete b.user),app.rolesView.model.set(b)}})}}),app.PasswordView=Backbone.View.extend({el:"#password",template:_.template($("#tmpl-password").html()),events:{"click .btn-password":"password"},initialize:function(){this.model=new app.Password({_id:app.mainView.model.id}),this.listenTo(this.model,"sync",this.render),this.render()},render:function(){this.$el.html(this.template(this.model.attributes));for(var a in this.model.attributes)this.model.attributes.hasOwnProperty(a)&&this.$el.find('[name="'+a+'"]').val(this.model.attributes[a])},password:function(){this.model.save({newPassword:this.$el.find('[name="newPassword"]').val(),confirm:this.$el.find('[name="confirm"]').val()})}}),app.DeleteView=Backbone.View.extend({el:"#delete",template:_.template($("#tmpl-delete").html()),events:{"click .btn-delete":"delete"},initialize:function(){this.model=new app.Delete({_id:app.mainView.model.id}),this.listenTo(this.model,"sync",this.render),this.render()},render:function(){this.$el.html(this.template(this.model.attributes))},"delete":function(){confirm("Are you sure?")&&this.model.destroy({success:function(a,b){b.success?location.href="/admin/users/":app.deleteView.model.set(b)}})}}),app.MainView=Backbone.View.extend({el:".page .container",initialize:function(){app.mainView=this,this.model=new app.User(JSON.parse(unescape($("#data-record").html()))),app.headerView=new app.HeaderView,app.identityView=new app.IdentityView,app.passwordView=new app.PasswordView,app.rolesView=new app.RolesView,app.deleteView=new app.DeleteView}}),$(document).ready(function(){app.mainView=new app.MainView})}();
//# sourceMappingURL=details.min.js.map