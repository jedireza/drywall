!function(){"use strict";app=app||{},app._SearchResult=Backbone.Model.extend({defaults:{_id:void 0,name:"---",url:"---",type:"result"}}),app._SearchCollection=Backbone.Collection.extend({model:app._SearchResult,url:"/admin/search/",parse:function(a){var b=[];return a.users.length&&b.push({name:"Users",type:"header"}),_.each(a.users,function(a){b.push({name:a.username,url:"/admin/users/"+a._id+"/"})}),a.accounts.length&&b.push({name:"Accounts",type:"header"}),_.each(a.accounts,function(a){b.push({name:a.name.full,url:"/admin/accounts/"+a._id+"/"})}),a.administrators.length&&b.push({name:"Administrators",type:"header"}),_.each(a.administrators,function(a){b.push({name:a.name.full,url:"/admin/administrators/"+a._id+"/"})}),b}}),app._SearchView=Backbone.View.extend({el:"#_search",template:_.template($("#tmpl-_search").html()),events:{"keydown .form-control":"startKeyBuffer"},timeLastKeyPressed:void 0,lastTimeoutID:void 0,selectedResult:void 0,startKeyBuffer:function(a){if(app._searchView.timeLastKeyPressed=new Date,27===parseInt(a.keyCode,null))return void this.clearResults();if(13===parseInt(a.keyCode,null)){if(void 0!==this.selectedResult){var b=this.$el.find("li.active a").attr("href");b&&(location.href=b)}return!1}return 38===parseInt(a.keyCode,null)||40===parseInt(a.keyCode,null)?(this.navigateResults(a),!1):void((/[a-zA-Z0-9\-_ ]/.test(String.fromCharCode(parseInt(a.keyCode,null)))||8===parseInt(a.keyCode,null))&&this.keyBuffer())},keyBuffer:function(){(new Date-app._searchView.timeLastKeyPressed)/1e3>=.333?app._searchView.runSearch():(app._searchView.lastTimeoutID&&clearTimeout(app._searchView.lastTimeoutID),app._searchView.lastTimeoutID=setTimeout(app._searchView.keyBuffer,50))},runSearch:function(){var a=this.$el.find(".form-control").val();return a?void this.collection.fetch({data:{q:a},reset:!0}):void this.clearResults()},navigateResults:function(a){var b=this.$el.find("li a").get(),c=38===parseInt(a.keyCode,null),d=40===parseInt(a.keyCode,null);void 0===this.selectedResult&&this.$el.find("li a").get(0)&&(this.selectedResult=-1),c&&0===this.selectedResult?this.selectedResult=b.length-1:c&&(this.selectedResult-=1),d&&this.selectedResult===b.length-1?this.selectedResult=0:d&&(this.selectedResult+=1),this.selectedResult>b.length&&(this.selectedResult=0),0===b.length&&(this.selectedResult=void 0),this.selectResult()},selectResult:function(){void 0!==this.selectedResult&&(this.$el.find("li a").closest("li").attr("class",""),this.$el.find("li a:eq("+this.selectedResult+")").closest("li").attr("class","active"))},clearResults:function(){this.$el.find(".form-control").val(""),this.$el.find(".dropdown").removeClass("open"),this.$el.find("#_search-results-rows").html(""),this.selectedResult=void 0},initialize:function(){this.collection=new app._SearchCollection,this.collection.on("reset",this.render,this),this.$el.html(this.template()),this.render()},render:function(){""===this.$el.find(".form-control").val()?this.$el.find(".dropdown").removeClass("open"):this.$el.find(".dropdown").addClass("open"),$("#_search-results-rows").empty(),this.collection.each(function(a){var b=new app._SearchResultView({model:a});$("#_search-results-rows").append(b.render().$el)},this),0===this.collection.length&&$("#_search-results-rows").append($("#tmpl-_search-results-empty-row").html())}}),app._SearchResultView=Backbone.View.extend({tagName:"li",template:_.template($("#tmpl-_search-results-row").html()),events:{"click .btn-details":"goTo"},goTo:function(){location.href=this.model.get("url")},render:function(){return this.$el.html(this.template(this.model.attributes)),"header"===this.model.get("type")&&this.$el.addClass("dropdown-header"),this}}),$(document).ready(function(){app._searchView=new app._SearchView})}();
//# sourceMappingURL=admin.min.js.map